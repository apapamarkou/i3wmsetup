#!/bin/bash

# exit on logout
trap 'echo "Exiting..."; exit' EXIT

# Get the name of the script (the script's basename)
SCRIPT_NAME=$(basename "$0")

# Get the PID of the current script
CURRENT_PID=$$

# Get all same script PIDs
PIDS_FOUND=$(pidof -x "$SCRIPT_NAME")

# Remove the current instance PID from the PIDs found
OTHER_PIDS=$(echo "$PIDS_FOUND" | sed "s/$CURRENT_PID//")

# Check is OTHER_PIDS except for CURRENT_PID exist
if [ -n "$OTHER_PIDS" ]; then
    echo "ANOTHER_INSTANCE_RUNNING"
    exit 1
fi

# Define the directories and scripts
WATCH_DIRS="/usr/share/applications $HOME/.local/share/applications"

processing_script="yapps -r"

# Start watching the directory
inotifywait -m -e create,delete,moved_to,moved_from \
            --format '%w %e %f' \
            --include '\.desktop$' \
            $WATCH_DIRS | while
echo "Watching $watch_directory"
read -r directory event file; do
	echo "Detected change ($action on $file). Triggering update..."
    yapps -r &
done
