#!/bin/bash

# __   __    _   _ _   _ ___  __
# \ \ / /__ | | | | \ | (_) \/ /
#  \ V / _ \| | | |  \| | |\  / 
#   | | (_) | |_| | |\  | |/  \ 
#   |_|\___/ \___/|_| \_|_/_/\_\
#
# Lisence GPL3
# Homepage: https://github.com/apapamarkou/younix
# Author: Andrianos Papamarkou
# Email: papamarkoua@gmail.com

#
# YoUNiX Worker Script
#

InstallYay() {
    echo -e "\e[33mInstalling Yay AUR helper\e[0m"
    echo
    sudo pacman -S --needed git base-devel
    git clone https://aur.archlinux.org/yay.git /tmp/yay
    cd /tmp/yay
    makepkg -si
    cd -
    rm -rf /tmp/yay
    read -p "Press Enter to continue..."
}

installFlatpak() {
    echo -e "\e[33mInstalling Flatpak support\e[0m"
    echo
    sudo pacman -S flatpak
    flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo
    echo "Restart to complete Flatpak installation"
    read -p "Press Enter to continue..."
}

installSnap() {
    echo -e "\e[33mInstalling Snap support\e[0m"
    echo
    git clone https://aur.archlinux.org/snapd.git
    cd snapd
    makepkg -si
    cd ..
    rm -rf snapd
    sudo systemctl enable --now snapd.socket
    sudo ln -sf /var/lib/snapd/snap /snap
    read -p "Press Enter to continue..."
}

updateAll() {
    echo -e "\e[33mUpdating all type of packages\e[0m"
    echo
    updateRepos
    updateAUR
    command -v flatpak &> /dev/null && updateFlatpak
    command -v snap &> /dev/null && updateSnap
}

updateRepos() {
    echo -e "\e[33mUpdating repos\e[0m"
    echo
    sudo pacman -Syu
    read -p "Press Enter to continue..."
}

updateAUR() {
    echo -e "\e[33mUpdating AUR\e[0m"
    echo
    yay -Sua
    read -p "Press Enter to continue..."
}

updateFlatpak() {
    echo -e "\e[33mUpdating Flatpak\e[0m"
    flatpak update
    read -p "Press Enter to continue..."
}

updateSnap() {
    echo -e "\e[33mUpdating Snap\e[0m"
    sudo snap refresh
    read -p "Press Enter to continue..."
}

figlet "$DISTRO_NAME  System"
case $1 in
    InstallYay) InstallYay ;;
    installFlatpak) installFlatpak ;;
    installSnap) installSnap ;;
    updateAll) updateAll ;;
    updateRepos) updateRepos ;;
    updateAUR) updateAUR ;;
    updateFlatpak) updateFlatpak ;;
    updateSnap) updateSnap ;;
    *) echo "Invalid function"; exit 1 ;;
esac