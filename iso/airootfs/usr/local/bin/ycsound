#!/bin/bash

# __   __    _   _ _   _ ___  __
# \ \ / /__ | | | | \ | (_) \/ /
#  \ V / _ \| | | |  \| | |\  / 
#   | | (_) | |_| | |\  | |/  \ 
#   |_|\___/ \___/|_| \_|_/_/\_\
#
# Lisence GPL3
# Homepage: https://github.com/apapamarkou/younix
# Author: Andrianos Papamarkou
# Email: papamarkoua@gmail.com

#
# YoUNiX Configure Sound
#

SCRIPT_NAME=$(basename "$0")
TITLE="Configure Sound"

showHelp() {
    echo "$DISTRO_NAME Configure Sound"
    echo "Usage: ycsound [OPTIONS]"
    echo "Options:"
    echo "  -t    Open in terminal"
    echo "  -h    Show this help"
    echo "Arguments can be combined: -vh, etc."
}

openTerminal() {
    nohup flock -n $LOCK_DIR/$SCRIPT_NAME.lock terminal --columns=50 --lines=15 --title="$FLOATING_PREFIX $TITLE" $SCRIPT_NAME
}

displayMenu() {
    while true; do
        clear
        yprint -c --color=yellow "$DISTRO_NAME $TITLE"
        # relative fzf height by terminal height
        height=$(($(tput lines) - 2))
        choice=$(printf "󱡭  Audio Input\n󱡫  Audio Output\n  Volume Mixer\n  Sample Rate\n  Buffer Size\n$EXIT_TEXT" | fzf --layout=reverse --prompt='  > ' --height=$height);        
        case "$choice" in
            *Input*) ycsoundinput -e ;;
            *Output*) ycsoundoutput -e ;;
            *Mixer*) ycsoundmixer -e ;;
            *Sample*) ycsamplerate -e ;;
            *Buffer*) ycbuffersize -e ;;
            *) return ;;  # Back ή κενή επιλογή
        esac
    done
}

OPEN_TERMINAL=false
EXIT_TEXT="󰈆  Exit"

while getopts "eth" opt; do
    case $opt in
        e) EXIT_TEXT="󰌍  Back" ;;
        t) OPEN_TERMINAL=true ;;
        h) showHelp; exit 0 ;;
        \?) echo "Invalid option. Use -h for help."; exit 1 ;;
    esac
done

if [ "$OPEN_TERMINAL" = true ]; then
    openTerminal
    exit 0
fi

displayMenu