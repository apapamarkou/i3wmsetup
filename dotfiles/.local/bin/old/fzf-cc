#!/usr/bin/env bash

# __   _____  _   _ _   _ _____  __
# \ \ / / _ \| | | | \ | |_ _\ \/ /
#  \ V / | | | | | |  \| || | \  /
#   | || |_| | |_| | |\  || | /  \
#   |_| \___/ \___/|_| \_|___/_/\_\
#
# Lisence GPL3
# Homepage: https://github.com/apapamarkou/younix
# Author: Andrianos Papamarkou
# Email: papamarkoua@gmail.com

# FZF Configuration Center for YOUNIX desktop environment

WALLPAPER_DIR="$HOME/Pictures/Wallpapers"
MUSIC_DIR="$HOME/Music"

change() {
    local monitor="$1"
    local file="$HOME/.profile" 

    if grep -q '^export SYSTEM_MONITOR=' "$file"; then
        if sed --version >/dev/null 2>&1; then
            sed -i "s|^export SYSTEM_MONITOR=.*|export SYSTEM_MONITOR=\"$monitor\"|" "$file"
        else
            sed -i '' "s|^export SYSTEM_MONITOR=.*|export SYSTEM_MONITOR=\"$monitor\"|" "$file"
        fi
        notify-send "✅ System monitor changed to $1. The change will be available at the next login."
    else
        echo "export SYSTEM_MONITOR=\"$monitor\"" >> "$file"
	fi
}

system_monitor_menu() {
    local ACTION
    ACTION=$(printf '󰍹  top\n󰷜  htop\n󰨇  btop\n  Back' | fzf --layout=reverse --prompt='   Select > ' --height=40)
    
    case "$ACTION" in
        *top*) change top ;;
        *htop*) change htop ;;
        *btop*) change btop ;;
        *) return ;;  # Back ή κενή επιλογή
    esac
}

power_menu() {
	local ACTION
	ACTION=$(printf '  Lock\n󰗽  Logout\n  Reboot\n⏻  Poweroff\n  Back' | fzf --layout=reverse --prompt='  Action > ' --height=40%);
	case "$ACTION" in
		*Lock*) i3lock ;;
		*Logout*) i3-msg exit ;;
		*Reboot*) systemctl reboot ;;
		*Poweroff*) systemctl poweroff ;;
	esac
}

terminal_menu() {
	local ACTION
    while true; do
        clear
        ACTION=$(printf '  Default Terminal\n󰗽  Default Shell\n  Back' | fzf --layout=reverse --prompt='  > ' --height=40%);
        case "$ACTION" in
            *Terminal*) fzf-terminal-select ;;
            *Shell*) fzf-select-shell ;;
            *) return ;;  # Back ή κενή επιλογή
        esac
    done
}

display_menu() {
	local ACTION
    while true; do
        clear
        ACTION=$(printf '󰍹  Monitor Configuration\n  Night Light\n  Back' | fzf --layout=reverse --prompt='  > ' --height=40%);
        case "$ACTION" in
            *Configuration*) arandr >/dev/null 2>&1 & ;;
            *Night*) fzf-redshift-menu ;;
            *) return ;;  # Back ή κενή επιλογή
        esac
    done
}


MENU_NAMES=(
	"󰍹  Display"
	"  Look & Theme"
    "  System Monitor"
    "󰀂  Network"
    "  Terminal Preferences"
    "󰗅  Sound"
    "  Language"
    "  System Maintenance"
    "󰤄  Power Profiles"
    "󰐥  Power Menu"
    "❌ Exit"
)

MENU_COMMANDS=(
	display_menu
	fzf-look-menu
    system_monitor_menu
	netconf
    terminal_menu
	fzf-sound
	fzf-language-prefs
    fzf-system-maintenance
	powerprofileswindow
    power_menu
    exit 0
)

while true; do

	
	
    choice=$(printf "%s\n" "${MENU_NAMES[@]}" | fzf --layout=reverse --prompt="  > " --height=50% --border --ansi)

    # Exit if Esc or no selection
    [ -z "$choice" ] && exit 0

    for i in "${!MENU_NAMES[@]}"; do
        if [[ "$choice" == "${MENU_NAMES[$i]}" ]]; then
            # Exit explicitly if selected
            [[ "$choice" == "❌ Exit" ]] && exit 0
            eval "${MENU_COMMANDS[$i]}"
            break
        fi
    done
done
