#!/bin/bash

# __   _____  _   _ _   _ _____  __
# \ \ / / _ \| | | | \ | |_ _\ \/ /
#  \ V / | | | | | |  \| || | \  /
#   | || |_| | |_| | |\  || | /  \
#   |_| \___/ \___/|_| \_|___/_/\_\
#
# Lisence GPL3
# Homepage: https://github.com/apapamarkou/younix
# Author: Andrianos Papamarkou
# Email: papamarkoua@gmail.com

# FZF Power Profiles and Auto-Suspend Configuration Menu for YOUNIX desktop environment

# ---------- Power Profiles ----------
PROFILES=$(powerprofilesctl list | awk -F: '
/:/ {
  gsub(/^[ \t*]+|[ \t]+$/, "", $1)
  if ($1=="performance") print "󱄟 "$1
  else if ($1=="balanced") print "⚖️ "$1
  else if ($1=="power-saver") print "󱩳 "$1
}')

CURRENT_PROFILE=$(powerprofilesctl get)

SELECTED_PROFILE=$(echo "$PROFILES" | \
  fzf --prompt="⚡ Select Power Profile: " \
      --header="Current: $CURRENT_PROFILE" \
      --reverse --cycle --select-1 --exit-0 \
      --preview-window=up:1:noborder \
      --preview="echo '→ $CURRENT_PROFILE is active'")

if [ -n "$SELECTED_PROFILE" ]; then
    CLEAN_PROFILE=$(echo "$SELECTED_PROFILE" | awk '{print $2}')
    powerprofilesctl set "$CLEAN_PROFILE"
    notify-send "⚡ Power Profile Changed" "Now: $CLEAN_PROFILE"
fi

# ---------- Auto-Suspend Settings ----------
# Define options: format "Description:command"
SUSPEND_OPTIONS=$(
cat <<EOF
 Never|sudo systemctl mask sleep.target suspend.target hibernate.target hybrid-sleep.target
 5 min|sudo systemctl suspend --timeout=300
 15 min|sudo systemctl suspend --timeout=900
 30 min|sudo systemctl suspend --timeout=1800
EOF
)

# Show only description in fzf
SELECTED_DESC=$(echo "$SUSPEND_OPTIONS" | cut -d'|' -f1 | \
    fzf --prompt=" Auto-Suspend: " \
        --reverse --cycle --exit-0)

# Find the corresponding command
if [ -n "$SELECTED_DESC" ]; then
    CMD=$(echo "$SUSPEND_OPTIONS" | grep -F "^$SELECTED_DESC|" | cut -d'|' -f2-)
    eval "$CMD"
    notify-send " Auto-Suspend Set" "$SELECTED_DESC"
fi

